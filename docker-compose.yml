version: '3'

volumes:
  mysql_data:
    external: true

services:

  nginx:
    image: nginx:latest
    volumes:
      - ./serve:/var/lib/html
      - ./bookworm/Bookworm-Vega/dist/:/var/lib/html/vega
      - ./compose/nginx/templates:/etc/nginx/templates
    environment:
     - NGINX_HOST=foobar.com
     - NGINX_PORT=80 # The host within the container that nginx serves over.
    expose:
      - "80"
    depends_on:
      - mariadb
      - bookworm

  mariadb:
    image: mariadb:latest
    volumes:
      - mysql_data:/var/lib/mysql
    environment:
      # Put this in docker-compose.override.yml, with a secure password
      - MYSQL_ROOT_PASSWORD=insecure_dev_root_password

  bookworm:
    build:
      context: .
      dockerfile: ./compose/bookworm/Dockerfile
    environment:
      # Put this in docker-compose.override.yml, with a secure password
      - MYSQL_ROOT_PASSWORD=insecure_dev_root_password
    depends_on:
      - mariadb
    volumes:
      - ./corpus:/corpus
#      - ./compose/bookworm/default_mysql_config:/etc/bookworm/
      - ./bookworm/BookwormDB:/BookwormDB/
    command: bookworm serve --bind 0.0.0.0
